# Xorg configuration for headless GPU rendering with NVIDIA via modesetting
# Uses DRM/KMS with NVIDIA's modesetting support for GPU-accelerated OpenGL
# Works with nvidia-container-runtime without needing nvidia_drv.so

Section "ServerLayout"
    Identifier     "Layout0"
    Screen      0  "Screen0"
EndSection

Section "Files"
    ModulePath   "/usr/lib/x86_64-linux-gnu/xorg/extra-modules"
    ModulePath   "/usr/lib/xorg/modules"
EndSection

Section "Module"
    Load           "glx"
    Load           "dri2"
    Load           "dri3"
EndSection

Section "Device"
    Identifier     "Device0"
    Driver         "modesetting"
    # Let modesetting auto-detect the GPU device
    # RunPod exposes GPU at varying /dev/dri/cardN paths
    Option         "AccelMethod" "glamor"
    Option         "AsyncFlipSecondaries" "true"
EndSection

Section "Screen"
    Identifier     "Screen0"
    Device         "Device0"
    DefaultDepth    24
    SubSection     "Display"
        Depth       24
        Modes      "1920x1080"
    EndSubSection
EndSection

Section "ServerFlags"
    Option         "AutoAddGPU" "true"
    Option         "AllowEmptyInitialConfiguration" "true"
EndSection
